/****************************************************************************************************			MacZoop - "the framework for the rest of us"		 ****			ZMDEFWindow.cpp		-- a window that will display a menu. Handy for palettes*									that are created by tearing off a menu- the window*									can use the MDEF to display its contents.******			© 1999, Graham Cox*****************************************************************************************************/#include	"ZMDEFWindow.h"#include	"ZGrafState.h"#include	"MacZoop.h"#include	<Menus.h>ZMDEFWindow::ZMDEFWindow( ZCommander* aBoss, const short id, MenuHandle aMenu, Boolean becomeOwner )	: ZWindow( aBoss, id ){	ownsMenu = becomeOwner;	itsMenu = aMenu;		FailNILParam( itsMenu );		mdef = (*aMenu)->menuProc;		FailNILParam( mdef );		item = -1;}ZMDEFWindow::~ZMDEFWindow(){	if ( ownsMenu )		DisposeMenu( itsMenu );}void	ZMDEFWindow::InitZWindow(){	ZWindow::InitZWindow();		CalcMenuSize( itsMenu );	SetSize((*itsMenu)->menuWidth, (*itsMenu)->menuHeight );}void	ZMDEFWindow::DrawContent(){	Point 		hp = { 0, 0 };	char		hs;	Rect		gr;		hs = HGetState( mdef );	HLockHi( mdef );		gr = *WINDOWPORTRECT( macWindow );		// draw the menu		CallMenuDefProc((MenuDefUPP) *mdef, kMenuDrawMsg, itsMenu, &gr, hp, &item );	HSetState( mdef, hs );}void	ZMDEFWindow::Click( const Point mouse, const short modifiers ){	char	hs;	Point	lp = { -1, -1 }, pp = mouse;		hs = HGetState( mdef );	HLockHi( mdef );		do	{		if ( DeltaPoint( lp, pp ))		{			CallMenuDefProc((MenuDefUPP) *mdef, kMenuChooseMsg, itsMenu, WINDOWPORTRECT( macWindow ), pp, &item );			lp = pp;		}		GetMouse( &pp );	}	while( WaitMouseUp());		// simulate the menu flash		lp.h = lp.v = -1;		short	di = item;		for( short i = 0; i < LMGetMenuFlash(); i++ )	{		CallMenuDefProc((MenuDefUPP) *mdef, kMenuChooseMsg, itsMenu, WINDOWPORTRECT( macWindow ), lp, &di );		MZDelay( 3 );		CallMenuDefProc((MenuDefUPP) *mdef, kMenuChooseMsg, itsMenu, WINDOWPORTRECT( macWindow ), pp, &di );		MZDelay( 3 );	}		HSetState( mdef, hs );	SendMessage( kMsgNewWMenuItemChosen, (void*)(((long)GETMENUIDFROMHANDLE( itsMenu ) << 16 ) + item ));}